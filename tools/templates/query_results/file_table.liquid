<table class="folder-content">
    <thead>
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Description</th>
        <th scope="col">Size</th>
        <th scope="col">Coverage</th>
      </tr>
    </thead>
    <tbody>
    {%- for file in files %}
        {% capture file_url %}/{{ tree }}/{% if rev %}rev/{{ rev }}{% else %}source{% endif %}/{{ file.path }}{% endcapture -%}
        {%- if file.concise.is_dir -%}
            {%- assign icon_kind = "folder" -%}
            {%- assign file_size = "" %}
            {%- assign node_kind = "folder" %}
        {%- else -%}
            {%- capture icon_kind %}{{ file.path | fileext }}{% endcapture -%}
            {%- capture file_size %}{{ file.concise.file_size }}{% endcapture -%}
            {%- assign node_kind = "file" %}
        {%- endif -%}
        <tr>
          {% comment %}
          We used to have images be their own icon by hitting the hg server, but
          this seems wasteful for both the user and the hg server.  Searchfox is
          also absolutely capable of downsampling the image, so if people ask
          for this feature to come back, we should probably pre-compute low(er)
          resolution versions of the icons.
          {% endcomment -%}
          <td class="name"><a href="{{ file_url }}" class="mimetype-fixed-container mimetype-icon-{{ icon_kind }}">{{ file.path | split: "/" | last }}</a></td>
          <td class="description"><a href="{{ file_url }}" title="{{ file.concise.description | default: "" | escape }}">{{ file.concise.description | default: "" | escape }}</td>
          <td class="size"><a href="{{ file_url }}">{{ file_size }}</a></td>
          {% assign coverage = file.concise.coverage %}
          {%- if coverage != nil and coverage.linesTotal != 0 -%}
            {%- assign coverage_bucket = coverage.coveragePercent | divided_by: 10 | floor -%}
            {%- capture coverage_title -%}{{ coverage.linesCovered }} lines out of {{ coverage.linesTotal }} instrumented lines are covered in this {{ node_kind }}."{%- endcapture -%}
            {%- capture coverage_content -%}{{ coverage.coveragePercent | round }}â€¯%{%- endcapture -%}
          {%- else -%}
            {%- assign coverage_bucket = "none" -%}
            {%- capture coverage_title -%}There's no coverage data available for this {{ node_kind }}.{%- endcapture -%}
            {%- capture coverage_content -%} - {%- endcapture -%}
          {%- endif -%}
          <td class="coverage"><a href="{{ file_url }}" class="cov-percentage cov-percentage-{{ coverage_bucket }}" title="{{ coverage_title }}">{{ coverage_content }}</a></td>
        </tr>
{% endfor %}
    </tbody>
</table>
